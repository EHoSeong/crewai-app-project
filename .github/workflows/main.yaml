# 워크플로우의 이름 (GitHub Actions 탭에 표시됨)
name: CI-Docker-Image-Build-and-Push

# 워크플로우가 시작될 조건
on:
  push:
    branches: [ "main" ] # main 브랜치에 코드가 push 될 때 실행

# 실행될 작업(Job) 정의
jobs:
  build-and-push:
    # 작업을 실행할 가상 서버 환경
    runs-on: ubuntu-latest

    # 작업의 세부 단계(Step)들
    steps:
      # 1. GitHub 저장소의 코드를 가상 서버로 내려받음
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Docker Hub 로그인 (GitHub Secrets에 저장된 정보를 사용)
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      # 3. Docker 이미지를 빌드하고 Docker Hub로 푸시
      - name: Build and push Docker image
        uses: docker/build-push-action@v4
        with:
          context: . # 현재 폴더 위치에서 빌드
          push: true # 빌드 후 푸시 실행
          tags: ${{ secrets.DOCKERHUB_USERNAME }}/crewai-app:latest # 이미지 태그 설정